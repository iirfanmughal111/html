!function(s,t){"use strict";XF.Groups_CoverSetup=XF.Element.newHandler({options:{crop:null,forceHeight:null,src:null,width:null,height:null,debug:!1},$imgParent:null,isTooltip:!1,setupClass:"groupCoverFrame--setup",init:function(){var i=0,o=0,e=this;this.options.crop&&this.options.crop.w&&(this.$target.closest(".groupCover-editor").length||(this.$imgParent=this.$target.closest(".groupCoverFrame"),this.$imgParent.length&&(this.$imgParent.addClass(this.setupClass),this.isTooltip=0<this.$target.closest(".tooltip").length,this.isTooltip&&this.$imgParent.width(this.$target.closest(".tooltip").width()),s(t).on("resize orientationchange",function(){i&&(clearTimeout(i),i=0),i=setTimeout(function(){i=0;var t=e.$target.width();t!==o&&(o=t,e.calcPosition())},10)}),this.calcPosition())))},calcPosition:function(){this.debug("Cover begin calc position...","isTooltip",this.isTooltip);var t=this.$imgParent.width(),i=this.$imgParent.height(),o=(this.debug("Cover frame dimensions","width",t,"height",i),this.options.width),e=this.options.height,s=(this.debug("imageWidth",o,"imageHeight",e),parseInt(this.options.crop.w,10)||o),n=parseInt(this.options.crop.h,10)||e,r=parseFloat(this.options.crop.y)||0,n=(this.debug("cropFrameWidth",s,"cropFrameHeight",n,"cropPositionY",r),t/s),t=n*e,s=(this.debug("newImageWidth",n*o,"newImageHeight",t),r/e*t);this.debug("newPositionY",s),Math.abs(s)+i>t&&(this.debug("Adjust position Y"),s=i-t),this.$target.css({top:s}).removeClass(this.setupClass),this.options.src&&this.$target.attr("src",this.options.src),this.debug("Calc done...")},debug:function(){this.options.debug}}),XF.Groups_CommentLoader=XF.Element.newHandler({options:{href:null,container:null,messageSelector:null,isAfter:!1,loaded:null},link:null,loading:!1,$container:null,loaded:[],init:function(){if(this.link=this.options.href||this.$target.attr("href"),!this.link)throw new Error("Invalid link to load.");if(this.$container=XF.findRelativeIf(this.options.container,this.$target),!this.$container.length)throw new Error("Invalid container.");var o=this;s(this.$container).find(this.options.messageSelector).each(function(t,i){i=s(i);o.loaded.push(i.data("row-id"))}),this.options.loaded&&this.options.loaded.forEach(function(t){o.loaded.push(t)}),this.$target.bind("click",XF.proxy(this,"onClick"))},onClick:function(t){var i;t.preventDefault(),this.loading||(this.loading=!0,i=this,XF.ajax("POST",this.link,this.getRequestData(),s.proxy(this,"onResponse")).always(function(){i.loading=!1}))},getRequestData:function(){return{loaded:this.loaded}},onResponse:function(t){var i;t.html&&(this.loaded=t.loaded,i=this,t.hasMore||this.$target.remove(),XF.setupHtmlInsert(t.html,function(t){i.options.isAfter?t.appendTo(i.$container):t.prependTo(i.$container)}))}}),XF.Groups_ReplyClick=XF.Click.newHandler({eventNameSpace:"Groups_ReplyClick",options:{author:null,level:null,target:null,focusOnly:!1},$form:null,$editor:null,formVisible:!1,init:function(){this.$form=XF.findRelativeIf(this.options.target,this.$target),this.$editor=XF.getEditorInContainer(this.$form)},click:function(t){t.preventDefault();var i=this;if(this.options.focusOnly)return this.$form.find(".editorPlaceholder").trigger("click"),void setTimeout(function(){XF.focusEditor(i.$form)},150);this.formVisible?(this.$form.hide(),this.formVisible=!1,XF.clearEditorContent(this.$form)):(this.$form.show(),this.formVisible=!0,XF.replaceEditorContent(i.$form,"@"+i.options.author+"&nbsp;","[USER]"+i.options.author+"[/USER]&nbsp;"),setTimeout(function(){XF.focusEditor(i.$form)},250))}}),XF.Element.register("tlg-comment-loader","XF.Groups_CommentLoader"),XF.Element.register("tlg-cover-setup","XF.Groups_CoverSetup"),XF.Event.register("click","tlg-reply","XF.Groups_ReplyClick")}(jQuery,this,document);