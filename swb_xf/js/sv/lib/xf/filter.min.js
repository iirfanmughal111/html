var SV=window.SV||{};SV.StandardLib=SV.StandardLib||{};
(function(c,e,f,g){SV.StandardLib.DynamicFilter=XF.extend(XF.Filter,{__backup:{init:"svLib__init",_filterAjax:"svLib__filterAjax",filter:"svLib__filter",update:"svLib__update",_filterAjaxResponse:"svLib__filterAjaxResponse"},options:c.extend({},XF.Filter.prototype.options,{svLoadInOverlay:!0,svPageNavWrapper:".block-outer--page-nav-wrapper"}),resetPage:!0,skipUpdate:!1,inOverlay:!1,svLastPageSelected:null,_getStoredValue:function(){return null},_updateStoredValue:function(a,b){},init:function(){this.inOverlay=
0!==this.$target.parents(".overlay-container").length;var a=null,b=this.getPageNavWrapper();b&&(a=this.getPageFromAhref(b.find(".pageNav-page--current").first()));this.svLastPageSelected="number"===typeof a?a:1;this.skipUpdate=!0;try{this.svLib__init()}finally{this.skipUpdate=!1}this.shimDynamicPageNav()},_filterAjax:function(a,b){var d=this.getCurrentPage()||1;a={_xfFilter:{text:a,prefix:b?1:0}};1!=d&&(a.page=d);this.xhrFilter=a._xfFilter;XF.ajax("GET",this.options.ajax,a,XF.proxy(this,"_filterAjaxResponse"))},
_filterAjaxResponse:function(a){this.svLib__filterAjaxResponse(a);var b=this.getPageNavWrapper();if(b){a=c(c.parseHTML(a.html.content));var d=a.find(this.options.svPageNavWrapper);d.length?(b.html(d.html()),this.shimDynamicPageNav(),this.inOverlay||(b=a.find('input[type="hidden"][name="final_url"]'),b.length?(b=b.val())?"pushState"in e.history?e.history.pushState({state:1,rand:Math.random()},"",b):e.location=b:console.error("No final URL available."):console.error("No final URL input was provided."))):
b.empty()}},update:function(){this.skipUpdate||this.svLib__update()},filter:function(a,b){this.resetPage&&(this.svLastPageSelected=1);this._toggleFilterHide(0<a.length);this.options.ajax?this._filterAjax(a,b):(a=this._applyFilter(this._getSearchRows(),a,b),this._toggleNoResults(0===a))},shimDynamicPageNav:function(){var a=this.getPageNavWrapper();a&&(a.find(".pageNav a[href]").on("click",XF.proxy(this,"ajaxLoadNewPage")),XF.activate(a))},getPageFromAhref:function(a){a=a.attr("href");a=new Url(a);
return"page"in a.query?parseInt(a.query.page)||1:1},ajaxLoadNewPage:function(a){a.preventDefault();a=this.getPageFromAhref(c(a.target));if(a!=this.svLastPageSelected){this.svLastPageSelected=a;this.resetPage=!1;try{this.update()}finally{this.resetPage=!0}}},getPageNavWrapper:function(a){a="undefined"===typeof a?!0:a;if(!this.options.svPageNavWrapper)return a&&console.error("No pagination wrapper query expression defined"),null;var b=c(this.options.svPageNavWrapper);return b.length?b:(a&&console.error("No old pagination wrapper available"),
null)},getCurrentPage:function(){if(!this.options.svPageNavWrapper||!this.getPageNavWrapper(!1))return null;var a=parseInt(this.svLastPageSelected)||null;return a?a:null}});XF.Element.register("sv-dynamic-filter","SV.StandardLib.DynamicFilter")})(jQuery,window,document);
