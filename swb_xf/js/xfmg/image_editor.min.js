'use strict';var XFMG=window.XFMG||{};
!function(d,g,h,k){XFMG.ImageEditor=XF.Element.newHandler({options:{image:".js-mediaImg",cropData:".js-cropData",move:".js-ctrlDragMove",crop:".js-ctrlDragCrop",zoomIn:".js-ctrlZoomIn",zoomOut:".js-ctrlZoomOut",rotateLeft:".js-ctrlRotateLeft",rotateRight:".js-ctrlRotateRight",flipH:".js-ctrlFlipH",flipV:".js-ctrlFlipV",clear:".js-ctrlClear"},$image:null,init:function(){var a=this,b=this.$target,e=b.find(this.options.image),f=b.find(this.options.cropData);e.length&&e.is("img")||console.error("Image editor must contain an img element");
this.$image=e;e.cropper({viewMode:2,autoCrop:!1,ready:function(){b.find(a.options.move+", "+a.options.crop).on("click",XF.proxy(a,"dragMode"));b.find(a.options.zoomIn+", "+a.options.zoomOut).on("click",XF.proxy(a,"zoom"));b.find(a.options.rotateLeft+", "+a.options.rotateRight).on("click",XF.proxy(a,"rotate"));b.find(a.options.flipH+", "+a.options.flipV).on("click",XF.proxy(a,"flip"));b.find(a.options.clear).on("click",XF.proxy(a,"clear"))},crop:function(c){f.val(JSON.stringify({scaleX:c.scaleX,scaleY:c.scaleY,
rotate:c.rotate,x:c.x,y:c.y,width:c.width,height:c.height}))}})},dragMode:function(a){a=d(a.currentTarget);a.is(this.options.move)?this.$image.cropper("setDragMode","move"):a.is(this.options.crop)&&this.$image.cropper("setDragMode","crop")},zoom:function(a){a=d(a.currentTarget);a.is(this.options.zoomIn)?this.$image.cropper("zoom",.1):a.is(this.options.zoomOut)&&this.$image.cropper("zoom",-.1)},rotate:function(a){a=d(a.currentTarget);a.is(this.options.rotateLeft)?this.$image.cropper("rotate",-10):
a.is(this.options.rotateRight)&&this.$image.cropper("rotate",10)},flip:function(a){a=d(a.currentTarget);var b=a.data("scale");a.is(this.options.flipH)?this.$image.cropper("scaleX",b):a.is(this.options.flipV)&&this.$image.cropper("scaleY",b);a.data("scale",-1===b?1:-1)},clear:function(a){this.$image.cropper("clear")}});XF.Element.register("image-editor","XFMG.ImageEditor")}(jQuery,window,document);
