'use strict';var XFMG=window.XFMG||{};
!function(d,f,g,h){XFMG.attachmentManager=null;XFMG.MediaManager=XF.Element.newHandler({options:{mediaActionUrl:null,onInsertHandler:".js-mediaOnInsertHandler"},init:function(){XFMG.attachmentManager=XF.Element.applyHandler(this.$target,"attachment-manager",this.options);this.options=d.extend({},this.options,XFMG.attachmentManager.options);XFMG.attachmentManager.$filesContainer.on("click",this.options.actionButton,XF.proxy(this,"actionButtonClick"))},actionButtonClick:function(a){a.preventDefault();var b=
d(a.target);b.is("button")||(b=b.closest("button"));a=b.attr("data-action");b=b.closest(this.options.fileRow);switch(a){case "delete":this.deleteMediaItem(b)}},deleteMediaItem:function(a){var b=a.data("temp-media-id"),c=this.options.mediaActionUrl;b&&(c?XF.ajax("post",c,{delete:b},function(e){e.delete&&XFMG.attachmentManager.removeFileRow(a)},{skipDefaultSuccess:!0}):XFMG.attachmentManager.removeFileRow(a))}});XFMG.LinkChecker=XF.Element.newHandler({options:{pasteInput:".js-pasteInput",pasteError:".js-pasteError"},
$pasteInput:null,$pasteError:null,attachmentManager:null,init:function(){var a=this.$target;this.attachmentManager=XFMG.attachmentManager;this.$pasteInput=a.find(this.options.pasteInput);this.$pasteInput.length?(this.$pasteError=a.find(this.options.pasteError),this.$pasteInput.on("paste",XF.proxy(this,"paste")),a.on("ajax-submit:before",XF.proxy(this,"beforeSubmit")),a.on("ajax-submit:response",XF.proxy(this,"complete")),a.on("ajax-submit:error",XF.proxy(this,"error"))):console.error("No input to monitor for pasted text.")},
paste:function(a){var b=this.$pasteError,c=this;setTimeout(function(){c.$target.submit();b.removeClassTransitioned("is-active")},100)},beforeSubmit:function(a,b){null==this.attachmentManager&&(b.preventSubmit=!0,console.error("No attachment manager available on %o.",this.$target))},complete:function(a,b){b.errors||b.exception||(a.preventDefault(),this.$pasteInput.val(""),XF.hideOverlays(),this.attachmentManager.insertUploadedRow(b.attachment))},error:function(a,b){var c=this.$target.find(this.options.pasteError);
c.length&&(a.preventDefault(),c.find("div").text(b.errors[0]),c.addClassTransitioned("is-active"),this.$pasteInput.val(""))}});XF.Element.register("media-manager","XFMG.MediaManager");XF.Element.register("link-checker","XFMG.LinkChecker")}(jQuery,window,document);
