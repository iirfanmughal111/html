<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="PAGE_CONTAINER" modification_key="xa_sc_adds_items_queue_link_to_moderator_tools" description="Adds item queue link to the moderators tools in the XF Staff Bar." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:mod_tools_menu:bottom]-->]]></find>
    <replace><![CDATA[<xf:if is="$xf.visitor.is_moderator && $xf.visitor.canViewShowcaseItems() && $xf.visitor.canViewShowcaseItemQueue()">
	<a href="{{ link('showcase/item-queue') }}" class="menu-linkRow">{{ phrase('xa_sc_showcase_item_queue') }}</a>
</xf:if>

$0]]></replace>
  </modification>
  <modification type="public" template="core.less" modification_key="xa_sc_core_less_append" description="Append core_xa_sc.less to core.less" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/$/]]></find>
    <replace><![CDATA[{{ include('core_xa_sc.less') }}]]></replace>
  </modification>
  <modification type="public" template="editor" modification_key="xa_sc_editor_js" description="Adds the JS file for the showcase BB code button." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:include_js]-->]]></find>
    <replace><![CDATA[<xf:js src="xenaddons/showcase/editor.js" min="1" />
$0]]></replace>
  </modification>
  <modification type="admin" template="helper_criteria" modification_key="xa_sc_helper_criteria_page" description="Add the showcase categories page criteria." execution_order="25" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:page:after_nodes]-->]]></find>
    <replace><![CDATA[$0
			<xf:checkboxrow label="{{ phrase('xa_sc_showcase_categories') }}">
				<xf:option name="page_criteria[sc_categories][rule]" value="sc_categories" selected="{$criteria.sc_categories}"
					label="{{ phrase('xa_sc_page_is_within_categories:') }}">

					<xf:select name="page_criteria[sc_categories][data][sc_category_ids]" multiple="true" value="{$criteria.sc_categories.sc_category_ids}">
						<xf:foreach loop="$data.scCategories" value="$option">
							<xf:option value="{$option.value}" label="{$option.label}" />
						</xf:foreach>
					</xf:select>
					<xf:checkbox>
						<xf:option name="page_criteria[sc_categories][data][sc_category_only]" value="1" selected="{$criteria.sc_categories.sc_category_only}"
							label="{{ phrase('xa_sc_only_display_within_selected_categories_no_children') }}" />
					</xf:checkbox>

				</xf:option>
			</xf:checkboxrow>

<hr class="formRowSep" />]]></replace>
  </modification>
  <modification type="admin" template="helper_criteria" modification_key="xa_sc_helper_criteria_user" description="Add the showcase user criteria." execution_order="25" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:user:content_after_messages]-->]]></find>
    <replace><![CDATA[$0
<xf:option name="user_criteria[xa_sc_item_count][rule]" value="xa_sc_item_count" selected="{$criteria.xa_sc_item_count}"
	label="{{ phrase('xa_sc_user_has_added_at_least_x_items:') }}">
	<xf:numberbox name="user_criteria[xa_sc_item_count][data][items]" value="{$criteria.xa_sc_item_count.items}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_item_count_nmt][rule]" value="xa_sc_item_count_nmt" selected="{$criteria.xa_sc_item_count_nmt}"
	label="{{ phrase('xa_sc_user_has_added_no_more_than_x_items:') }}">
	<xf:numberbox name="user_criteria[xa_sc_item_count_nmt][data][items]" value="{$criteria.xa_sc_item_count_nmt.items}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_item_prefix][rule]" value="xa_sc_item_prefix" selected="{$criteria.xa_sc_item_prefix}"
	label="{{ phrase('xa_sc_user_has_at_least_1_item_with_prefix_id:') }}">
	<xf:numberbox name="user_criteria[xa_sc_item_prefix][data][prefix_id]" value="{$criteria.xa_sc_item_prefix.prefix_id}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_featured_item_count][rule]" value="xa_sc_featured_item_count" selected="{$criteria.xa_sc_featured_item_count}"
	label="{{ phrase('xa_sc_user_has_at_least_x_items_currently_featured:') }}">
	<xf:numberbox name="user_criteria[xa_sc_featured_item_count][data][items]" value="{$criteria.xa_sc_featured_item_count.items}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_featured_item_count_nmt][rule]" value="xa_sc_featured_item_count_nmt" selected="{$criteria.xa_sc_featured_item_count_nmt}"
	label="{{ phrase('xa_sc_user_has_no_more_than_x_items_currently_featured:') }}">
	<xf:numberbox name="user_criteria[xa_sc_featured_item_count_nmt][data][items]" value="{$criteria.xa_sc_featured_item_count_nmt.items}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_comment_count][rule]" value="xa_sc_comment_count" selected="{$criteria.xa_sc_comment_count}"
	label="{{ phrase('xa_sc_user_has_posted_at_least_x_comments:') }}">
	<xf:numberbox name="user_criteria[xa_sc_comment_count][data][comments]" value="{$criteria.xa_sc_comment_count.comments}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_comment_count_nmt][rule]" value="xa_sc_comment_count_nmt" selected="{$criteria.xa_sc_comment_count_nmt}"
	label="{{ phrase('xa_sc_user_has_posted_no_more_than_x_comments:') }}">
	<xf:numberbox name="user_criteria[xa_sc_comment_count_nmt][data][comments]" value="{$criteria.xa_sc_comment_count_nmt.comments}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_review_count][rule]" value="xa_sc_review_count" selected="{$criteria.xa_sc_review_count}"
	label="{{ phrase('xa_sc_user_has_posted_at_least_x_reviews:') }}">
	<xf:numberbox name="user_criteria[xa_sc_review_count][data][reviews]" value="{$criteria.xa_sc_review_count.reviews}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_review_count_nmt][rule]" value="xa_sc_review_count_nmt" selected="{$criteria.xa_sc_review_count_nmt}"
	label="{{ phrase('xa_sc_user_has_posted_no_more_than_x_reviews:') }}">
	<xf:numberbox name="user_criteria[xa_sc_review_count_nmt][data][reviews]" value="{$criteria.xa_sc_review_count_nmt.reviews}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_series_count][rule]" value="xa_sc_series_count" selected="{$criteria.xa_sc_series_count}"
	label="{{ phrase('xa_sc_user_has_created_at_least_x_series:') }}">
	<xf:numberbox name="user_criteria[xa_sc_series_count][data][series]" value="{$criteria.xa_sc_series_count.series}"
		size="5" min="0" step="1" />
</xf:option>

<xf:option name="user_criteria[xa_sc_series_count_nmt][rule]" value="xa_sc_series_count_nmt" selected="{$criteria.xa_sc_series_count_nmt}"
	label="{{ phrase('xa_sc_user_has_created_no_more_than_x_series:') }}">
	<xf:numberbox name="user_criteria[xa_sc_series_count_nmt][data][series]" value="{$criteria.xa_sc_series_count_nmt.series}"
		size="5" min="0" step="1" />
</xf:option>]]></replace>
  </modification>
  <modification type="public" template="member_list_macros" modification_key="xa_sc_member_list_macros_item_count" description="Add the showcase item count to member stats." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:stats:after_messages]-->]]></find>
    <replace><![CDATA[$0
<xf:if is="$xf.visitor.canViewShowcaseItems()">
	<xf:if is="$user.xa_sc_item_count">
		<li><dl class="pairs pairs--inline">
			<dt>{{ phrase('xa_sc_showcase_items') }}</dt>
			<dd>{$user.xa_sc_item_count|number}</dd>
		</dl></li>
	</xf:if>
	<xf:if is="$user.xa_sc_comment_count">
		<li><dl class="pairs pairs--inline">
			<dt>{{ phrase('xa_sc_showcase_comments') }}</dt>
			<dd>{$user.xa_sc_comment_count|number}</dd>
		</dl></li>
	</xf:if>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="member_macros" modification_key="xa_sc_member_macros_find_content" description="Add the find all showcase items by x link to the find content dropdown" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:find_menu:bottom]-->]]></find>
    <replace><![CDATA[<xf:if is="$xf.visitor.canViewShowcaseItems() && $user.xa_sc_item_count">
	<a href="{{ link('search/member', null, {'user_id': $user.user_id, 'content': 'sc_item'}) }}" rel="nofollow" class="menu-linkRow">{{ phrase('xa_sc_find_all_showcase_items_by_x', {'name': $user.username}) }}</a>
</xf:if>

$0]]></replace>
  </modification>
  <modification type="public" template="member_macros" modification_key="xa_sc_member_macros_item_count" description="Add the showcase item count to the member stats." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:stat_pairs:above_likes]-->]]></find>
    <replace><![CDATA[<xf:if is="$xf.visitor.canViewShowcaseItems()">
	<xf:if is="$user.xa_sc_item_count">
		<dl class="pairs pairs--rows pairs--rows--centered menu-fauxLinkRow">
			<dt>{{ phrase('xa_sc_showcase_items') }}</dt>
			<dd>
				<a href="{{ link('showcase/authors', $user) }}" class="menu-fauxLinkRow-linkRow u-concealed">
					{$user.xa_sc_item_count|number}
				</a>
			</dd>
		</dl>
	</xf:if>
	<xf:if is="$user.xa_sc_comment_count">
		<dl class="pairs pairs--rows pairs--rows--centered menu-fauxLinkRow">
			<dt>{{ phrase('xa_sc_showcase_comments') }}</dt>
			<dd>
				<span class="menu-fauxLinkRow-linkRow u-concealed">
					{$user.xa_sc_comment_count|number}
				</span>
			</dd>
		</dl>
	</xf:if>
</xf:if>
$0]]></replace>
  </modification>
  <modification type="public" template="member_view" modification_key="xa_sc_member_view_add_tab" description="Add the &quot;showcase items&quot; tab." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:tabs:after_recent_content]-->]]></find>
    <replace><![CDATA[$0

<xf:if is="$xf.visitor.canViewShowcaseItems() AND $user.xa_sc_item_count">
	<a href="{{ link('showcase/authors', $user) }}"
	   class="tabs-tab"
	   id="sc_items"
	   role="tab">{{ phrase('xa_sc_showcase_items') }}</a>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="member_view" modification_key="xa_sc_member_view_add_tab_pane" description="Add the &quot;showcase items&quot; tab pane." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:tab_panes:after_recent_content]-->]]></find>
    <replace><![CDATA[$0

<xf:if is="$xf.visitor.canViewShowcaseItems() AND $user.xa_sc_item_count">
	<li data-href="{{ link('showcase/authors', $user, {'from_profile': 1}) }}" role="tabpanel" aria-labelledby="sc_items">
		<div class="blockMessage">{{ phrase('loading...') }}</div>
	</li>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="post_macros" modification_key="xa_sc_add_convert_post_links" description="Adds convert post to update and review links" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:if is="$hasActionBarMenu">]]></find>
    <replace><![CDATA[			<xf:if is="$post.canConvertPostToScUpdate()">
				<a href="{{ link('posts/convert-post-to-sc-update', $post) }}" 
					class="actionBar-action actionBar-action--convert actionBar-action--menuItem"
					data-xf-click="overlay">{{ phrase('xa_sc_convert_post_to_update') }}</a>

				<xf:set var="$hasActionBarMenu" value="{{ true }}" />
			</xf:if>

			<xf:if is="$post.canConvertPostToScReview()">
				<a href="{{ link('posts/convert-post-to-sc-review', $post) }}" 
					class="actionBar-action actionBar-action--convert actionBar-action--menuItem"
					data-xf-click="overlay">{{ phrase('xa_sc_convert_post_to_review') }}</a>

				<xf:set var="$hasActionBarMenu" value="{{ true }}" />
			</xf:if>

$0]]></replace>
  </modification>
  <modification type="public" template="thread_view" modification_key="xa_sc_convert_thread_to_sc_item" description="Adds a link to the thread options for converting a thread to a showcase item" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:thread_tools_menu:before_footer]-->]]></find>
    <replace><![CDATA[<xf:if is="$thread.canConvertThreadToScItem()">
	<a href="{{ link('threads/convert-thread-to-sc-item', $thread) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('xa_sc_convert_thread_to_item') }}</a>
</xf:if>

$0]]></replace>
  </modification>
  <modification type="admin" template="tools_rebuild" modification_key="xa_sc_tools_rebuild" description="Append showcase rebuilds to the end of the rebuild caches system." execution_order="25" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:rebuild_bottom]-->]]></find>
    <replace><![CDATA[$0
<xf:include template="xa_sc_tools_rebuild" />]]></replace>
  </modification>
  <modification type="public" template="whats_new_wrapper" modification_key="xa_sc_whats_new_wrapper_links" description="Adds additional tabs to the whats_new_wrapper links" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:links:after_thread]-->]]></find>
    <replace><![CDATA[<xf:if is="$xf.visitor.canViewShowcaseItems()">
	<a class="{$baseClass} {{ $pageSelected == 'sc_new_item' ? {$selectedClass} : '' }}" href="{{ link('whats-new/showcase-items') }}" rel="nofollow">{{ phrase('xa_sc_new_showcase_items') }}</a>
	<xf:if is="$xf.visitor.canViewShowcaseComments()">	
		<a class="{$baseClass} {{ $pageSelected == 'sc_new_comment' ? {$selectedClass} : '' }}" href="{{ link('whats-new/showcase-comments') }}" rel="nofollow">{{ phrase('xa_sc_new_showcase_comments') }}</a>
	</xf:if>	
</xf:if>
$0]]></replace>
  </modification>
</template_modifications>
