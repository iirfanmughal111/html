!function(h,k,l,m){XF.CommentClick=XF.Click.newHandler({eventNameSpace:"XFCommentClick",options:{editorTarget:null,commentContainer:".js-commentContainer",href:null},$editorTarget:null,$commentForm:null,href:null,loading:!1,init:function(){var b=this.options.editorTarget;b?(this.$editorTarget=XF.findRelativeIf(b,this.$target),this.$editorTarget.length?(this.href=this.options.href||this.$target.attr("href"))||console.error("No comment URL specified."):console.error("No comment target found")):console.error("No comment editorTarget specified")},
click:function(b){this.$editorTarget&&this.href&&(b.preventDefault(),this.$editorTarget.parent().hasClass("is-commenting")&&h("form.message-quickReply").remove(),this.loading||(this.loading=!0,XF.ajax("GET",this.href,{},XF.proxy(this,"handleAjax"),{skipDefaultSuccessError:!0})))},handleAjax:function(b){var c=this.$editorTarget,d=this;b.errors||b.exception?this.loading=!1:XF.setupHtmlInsert(b.html,function(a,g){a.hide().insertAfter(c);XF.activate(a);d.$commentForm=a;a.on("ajax-submit:response",XF.proxy(d,
"commentSubmit"));a.find(".js-cancelButton").on("click",XF.proxy(d,"cancelClick"));a.find("input[type=hidden]").first().after('<input type="hidden" name="_xfInlineComment" value="1" />');c.parent().addClass("is-commenting");a.xfFadeDown(XF.config.speed.normal,function(){a.trigger("comment:shown");var e=a.find(d.options.commentContainer);e.length&&e.get(0).scrollIntoView(!0);d.loading=!1});a.trigger("comment:show")})},commentSubmit:function(b,c){if(!c.errors&&!c.exception){b.preventDefault();c.message&&
XF.flashMessage(c.message,3E3);var d=this.$editorTarget,a=this;XF.setupHtmlInsert(c.html,function(g,e,n){e=a.options.editorTarget;e=e.replace(/<|\|/g,"").replace(/#[a-zA-Z0-9_-]+\s*/,"");var f=g.find(e);f.hide();d.replaceWith(f);a.$editorTarget=f;XF.activate(f);a.stopCommenting(!1,function(){f.xfFadeDown();a.$commentForm.trigger("quickcomment:commentcomplete",c)})})}},cancelClick:function(b){this.stopCommenting(!0)},stopCommenting:function(b,c){var d=this.$editorTarget,a=this.$commentForm,g=this,
e=function(){d.parent().removeClass("is-commenting");b&&d.xfFadeDown();c&&c();a.remove();g.$commentForm=null};a?a.xfFadeUp(null,e):e()}});XF.Click.register("comment","XF.CommentClick")}(jQuery,window,document);